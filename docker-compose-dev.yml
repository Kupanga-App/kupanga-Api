
services:

  # ------------------------
  # 1️⃣ Spring Boot App
  # ------------------------
  kupanga:
    build:
      context: .
      dockerfile: Dockerfile        # Dockerfile léger Java 21 multi-stage
    container_name: panga-dev
    ports:
      - "8085:8080"                # Port local DEV
    env_file:
      - .env.dev
    depends_on:
      - db
      - minio
    restart: always
    # Limitation des ressources pour DEV
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M

  # ------------------------
  # 2️⃣ PostgreSQL Database
  # ------------------------
  db:
    image: postgis/postgis:15-3.4-alpine       # Version alpine pour plus léger
    container_name: kupanga-db-dev
    environment:
      POSTGRES_DB: kupanga_dev
      POSTGRES_USER: kupanga
      POSTGRES_PASSWORD: devpassword
    ports:
      - "5433:5432"                # Port local pour DEV
    volumes:
      - db-data-dev:/var/lib/postgresql/data
    restart: always
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M

  # ------------------------
  # 3️⃣ MinIO Storage
  # ------------------------
  minio:
    image: minio/minio:latest       # Image officielle MinIO
    container_name: minio-dev
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data
    ports:
      - "9001:9000"                 # Port local pour DEV
    volumes:
      - minio-data-dev:/data
    restart: always
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M

# ------------------------
# Volumes persistants
# ------------------------
volumes:
  db-data-dev:
  minio-data-dev:
